<eg-staff-banner bannerText="Cash Reports" i18n-bannerText>
</eg-staff-banner>

<div class="mb-5">
  <div>
    <div class="row">
      <div class="input-group col-lg-3">
        <div class="input-group-prepend">
          <div class="input-group-text" i18n>Start Date</div> 
          <eg-date-select [initialDate]="today" (onChangeAsYmd)="onStartDateChange($event)"></eg-date-select>
        </div>
      </div>
      <div class="input-group col-lg-3">
        <div class="input-group-prepend">
          <div class="input-group-text" i18n>End Date</div> 
          <eg-date-select [initialDate]="today" (onChangeAsYmd)="onEndDateChange($event)"></eg-date-select>
        </div>
      </div>
      <div class="input-group col-lg-4">
        <div class="input-group-prepend">
          <div class="input-group-text" i18n>View reports for</div>
        </div>
        <eg-org-select [applyDefault]="true" [disableOrgs]="disabledOrgs" (onChange)="onOrgChange($event)"></eg-org-select>
      </div>
      <div class="col-lg-2">
        <button class="btn btn-primary" (click)="searchForData(startDate, endDate)">Submit</button>
      </div>
    </div>
  </div>
</div>

<ul ngbNav #cashReportsNav="ngbNav" class="nav-tabs"
  [destroyOnHide]="false" activeId="deskPayments" (navChange)="eraseUserGrid()">
  <li ngbNavItem="deskPayments">
    <a ngbNavLink i18n>Desk Payments</a>
    <ng-template ngbNavContent>
      <div class="mt-3">
        <div class="row">
          <div class="col-sm-2" i18n>Total Cash Payments</div>
          <div class="col-sm-10">{{deskTotals.cash_payment | currency}}</div>
        </div>
        <div class="row">
          <div class="col-sm-2" i18n>Total Check Payments</div>
          <div class="col-sm-10">{{deskTotals.check_payment | currency}}</div>
        </div>
        <div class="row">
          <div class="col-sm-2" i18n>Total Credit Card Payments</div>
          <div class="col-sm-10">{{deskTotals.credit_card_payment | currency}}</div>
        </div>
        <eg-grid #deskPaymentGrid
          [disableSelect]="true"
          [disablePaging]="true"
          [dataSource]="deskPaymentDataSource"
          [sortable]="false">
          <eg-grid-column label="Workstation" name="workstation" [index]="true" i18n-label></eg-grid-column>
          <eg-grid-column label="Cash Payment" name="cash_payment" i18n-label datatype="money"></eg-grid-column>
          <eg-grid-column label="Check Payment" name="check_payment" i18n-label datatype="money"></eg-grid-column>
          <eg-grid-column label="Credit Card Payment" name="credit_card_payment" i18n-label datatype="money"></eg-grid-column>
        </eg-grid>
      </div>
    </ng-template>
  </li>
  <li ngbNavItem="userPayments">
    <a ngbNavLink i18n>User Payments</a>
    <ng-template ngbNavContent>
      <div class="mt-3">
        <div class="row">
          <div class="col-sm-2" i18n>Total Credit Payments</div>
          <div class="col-sm-10">{{userTotals.credit_payment | currency}}</div>
        </div>
        <div class="row">
          <div class="col-sm-2" i18n>Total Forgive Payments</div>
          <div class="col-sm-10">{{userTotals.forgive_payment | currency}}</div>
        </div>
        <div class="row">
          <div class="col-sm-2" i18n>Total Work Payments</div>
          <div class="col-sm-10">{{userTotals.work_payment | currency}}</div>
        </div>
        <div class="row">
          <div class="col-sm-2" i18n>Total Goods Payments</div>
          <div class="col-sm-10">{{userTotals.goods_payment | currency}}</div>
        </div>
        <eg-grid #userPaymentGrid
          (onRowActivate) = "onRowActivate($event)"
          [disableSelect]="true"
          [disablePaging]="true"
          [dataSource]="userPaymentDataSource"
          [sortable]="false">
          <eg-grid-column label="User" name="usr" [index]="true" i18n-label></eg-grid-column>
          <eg-grid-column label="Credit Payment" name="credit_payment" i18n-label datatype="money"></eg-grid-column>
          <eg-grid-column label="Forgive Payment" name="forgive_payment" i18n-label datatype="money"></eg-grid-column>
          <eg-grid-column label="Work Payment" name="work_payment" i18n-label datatype="money"></eg-grid-column>
          <eg-grid-column label="Goods Payment" name="goods_payment" i18n-label datatype="money"></eg-grid-column>
        </eg-grid>
      </div>
    </ng-template>
  </li>
</ul>
<div [ngbNavOutlet]="cashReportsNav"></div>

<eg-user-dialog #userDialog>
  <ng-container *ngIf="userDataSource.data && userDataSource.data.length>0">
    <eg-grid #userGrid
      [disableSelect]="true"
      [disablePaging]="true"
      [dataSource]="userDataSource"
      [sortable]="false">
      <eg-grid-column label="Card" name="card" [index]="true" i18n-label></eg-grid-column>
      <eg-grid-column label="Email" name="email" i18n-label></eg-grid-column>
      <eg-grid-column label="First Name" name="first_given_name" i18n-label></eg-grid-column>
      <eg-grid-column label="Family Name" name="family_name" i18n-label></eg-grid-column>
      <eg-grid-column label="Home OU" name="home_ou" i18n-label></eg-grid-column>
    </eg-grid>
  </ng-container>
</eg-user-dialog>
